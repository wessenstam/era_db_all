{"status":{},"contains_secrets":false,"product_version":"2.9.1","spec":{"description":"* [Fiesta Application](http:\/\/@@{NodeReact.address}@@\/)","resources":{"client_attrs":{"None":{"y":315,"x":772.75},"0044927b_deployment":{"y":190,"x":319.75},"cc3dd106-4007-41ec-ad74-10572fb09463":{"y":294.8663607217,"x":327.5990821651}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"NodeReact"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"21c5a65f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"52bdec78_runbook","main_task_local_reference":{"kind":"app_task","name":"21c5a65f_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"NodeReact"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7feaa10e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"75b1a5f3_runbook","main_task_local_reference":{"kind":"app_task","name":"7feaa10e_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"NodeReact"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e042bc0d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9ee27da6_runbook","main_task_local_reference":{"kind":"app_task","name":"e042bc0d_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"NodeReact"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a30ac1c7_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"57819f94_runbook","main_task_local_reference":{"kind":"app_task","name":"a30ac1c7_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"NodeReact"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"89549cc9_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"610f4641_runbook","main_task_local_reference":{"kind":"app_task","name":"89549cc9_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"NodeReact","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"NodeReact_AHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"nodereacte-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"6946d346-89db-41b2-bbf1-a05f38a9caf0"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"f5d86c71-c165-41a5-a54b-b2ed4e0a44f5","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_7_Cloud","uuid":"89f62162-368c-4fbf-82ba-cad0d9b9d9da"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CENTOS"}],"package_definition_list":[{"description":"CentOS 7 Cloud Image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_7_Cloud","version":"","options":{"type":"","name":"CentOS_7_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"7","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"NodeReact"}],"name":"Package3","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package3"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"1InstallSoftware"},{"kind":"app_task","name":"2ConfApp"},{"kind":"app_task","name":"3ConfNginx"}],"name":"47b39829_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"1InstallSoftware"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"2ConfApp"}},{"from_task_reference":{"kind":"app_task","name":"2ConfApp"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"3ConfNginx"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeReact"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"1InstallSoftware","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# Update and install packages\nsudo yum -y update\nsudo yum -y install wget git vim gcc gcc-c++ nginx\n\n# Install node\ncurl -sL https:\/\/rpm.nodesource.com\/setup_10.x | sudo bash -\nsudo yum install -y nodejs\nnode --version\n\n# Clone Repo\ngit clone https:\/\/github.com\/sharonpamela\/Fiesta.git\ncd ~\/Fiesta\nnpm install\ncd ~\/Fiesta\/client\nnpm install\nnpm run build\nnpm install nodemon concurrently\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeReact"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"2ConfApp","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# Modify DB config file\n\nsudo sed -i 's\/REPLACE_DB_NAME\/@@{db_name}@@\/g' ~\/Fiesta\/config\/config.js\nsudo sed -i 's\/REPLACE_DB_HOST_ADDRESS\/@@{db_host_address}@@\/g' ~\/Fiesta\/config\/config.js\nsudo sed -i 's\/REPLACE_DB_DIALECT\/@@{db_dialect}@@\/g' ~\/Fiesta\/config\/config.js\nsudo sed -i 's\/REPLACE_DB_DOMAIN_NAME\/@@{db_domain_name}@@\/g' ~\/Fiesta\/config\/config.js\nsudo sed -i 's\/REPLACE_DB_USER_NAME\/@@{db_username}@@\/g' ~\/Fiesta\/config\/config.js\ndb_password='@@{db_password}@@'\ndb_escaped_pass=\"${db_password\/\/\\\/\/\\\\\/}\"\nsudo sed -i \"s\/REPLACE_DB_PASSWORD\/`echo $db_escaped_pass`\/g\" ~\/Fiesta\/config\/config.js\n\n# Modify the footer file so that it displays which DB is powering the app\nsudo sed -i 's\/--\/@@{db_dialect}@@\/g' ~\/Fiesta\/client\/src\/components\/Footer\/index.js\n\n# Create the unit file\necho '[Service]\n\nExecStart=\/usr\/bin\/node \/home\/centos\/Fiesta\/index.js\nRestart=always\nRestartSec=2s\n\nStandardOutput=syslog\nStandardError=syslog\n\nSyslogIdentifier=fiesta\n\nUser=root\nGroup=root\n\nEnvironment=NODE_ENV=production PORT=5001\n\n[Install]\nWantedBy=multi-user.target' | sudo tee \/etc\/systemd\/system\/fiesta.service\n\n# Reload daemons and start service\nsudo systemctl daemon-reload\nsudo systemctl start fiesta\nsudo systemctl enable fiesta\nsudo systemctl status fiesta -l\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"NodeReact"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"3ConfNginx","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# install node websockets\n# sudo npm install ws\n\n# create the nginx config\nsudo mv \/etc\/nginx\/nginx.conf \/etc\/nginx\/nginx.confbkp\necho \"user nginx;\nworker_processes auto;\nerror_log \/var\/log\/nginx\/error.log;\npid \/run\/nginx.pid;\n# Load dynamic modules. See \/usr\/share\/doc\/nginx\/README.dynamic.\ninclude \/usr\/share\/nginx\/modules\/*.conf;\nevents {\n    worker_connections 1024;\n}\nhttp {\n    log_format  main  '\\$remote_addr - \\$remote_user [\\$time_local] \\\"\\$request\\\" '\n                      '\\$status \\$body_bytes_sent \\\"\\$http_referer\\\" '\n                      '\\\"\\$http_user_agent\\\" \\\"\\$http_x_forwarded_for\\\"';\n    access_log  \/var\/log\/nginx\/access.log  main;\n    sendfile            on;\n    tcp_nopush          on;\n    tcp_nodelay         on;\n    keepalive_timeout   65;\n    types_hash_max_size 2048;\n    include             \/etc\/nginx\/mime.types;\n    default_type        application\/octet-stream;\n    # Load modular configuration files from the \/etc\/nginx\/conf.d directory.\n    # See http:\/\/nginx.org\/en\/docs\/ngx_core_module.html#include\n    # for more information.\n    include \/etc\/nginx\/conf.d\/*.conf;\n    server {\n        listen       80 default_server;\n        listen       [::]:80 default_server;\n        server_name  @@{address}@@;\n        root         \/usr\/share\/nginx\/html;\n        # Load configuration files for the default server block.\n        include \/etc\/nginx\/default.d\/*.conf;\n        location \/ {\n        proxy_pass http:\/\/127.0.0.1:5001;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade \\$http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host \\$host;\n        proxy_cache_bypass \\$http_upgrade;\n        }\n        error_page 404 \/404.html;\n            location = \/40x.html {\n        }\n        error_page 500 502 503 504 \/50x.html;\n            location = \/50x.html {\n        }\n    }\n}\" | sudo tee \/etc\/nginx\/nginx.conf\n\n#allow app access if SELinux is enabled\nsudo setenforce Permissive\n\n# start and enable nginx\nsudo systemctl start nginx\nsudo systemctl enable nginx\nsudo systemctl status nginx -l","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"29790a71_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"47b39829_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Package3"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"e1cdd743_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"17adb48b_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"e1cdd743_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"0044927b_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Package3"}],"substrate_local_reference":{"kind":"app_substrate","name":"NodeReact_AHV"},"variable_list":[],"description":""}],"description":"","action_list":[],"name":"AHV","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"SECRET","name":"db_password","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"LOCAL","name":"db_name","value":"","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"db_dialect","value":"mssql","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"db_domain_name","value":"ntnxlab.local","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"db_username","value":"administrator","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"db_host_address","value":"","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"type":"USER"},"name":"FiestaNoDB"},"api_version":"3.0","metadata":{"last_update_time":"1580489913566100","kind":"blueprint","spec_version":7,"creation_time":"1580430017541530","name":"FiestaNoDB"}}